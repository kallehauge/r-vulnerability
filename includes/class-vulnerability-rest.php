<?php

namespace Rommel;

/**
 * Vulnerability_REST.
 *
 * @TODO...
 */
class Vulnerability_REST {

	/**
	 * The API version.
	 *
	 * @var string
	 */
	protected $version;

	/**
	 * The route namespace.
	 *
	 * @var string
	 */
	protected $route_namespace;

	/**
	 * The service that handles logic about "WPScan Vulnerability Database".
	 *
	 * @var \Rommel\Vulnerability_Service
	 */
	protected $service;

	/**
	 * Constructor.
	 *
	 * @param string $text_domain
	 *   The text domain for the plugin.
	 * @param \Rommel\Vulnerability_Service $service
	 *   The service that handles logic about "WPScan Vulnerability Database".
	 */
	public function __construct( $text_domain, Vulnerability_Service $service ) {
		$this->route_namespace = $text_domain;
		$this->service = $service;
		$this->version = 'v1';
	}

	/**
	 * @TODO ...
	 */
	public function init() {
		register_rest_route( $this->route_namespace . '/' . $this->version, 'get-vulnerabilities', [
			'methods' => \WP_REST_Server::READABLE,
			'callback' => function() {
				return rest_ensure_response( $this->service->get_vulnerabilities() );
			},
		]);
	}

}
