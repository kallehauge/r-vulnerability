<?php

namespace Rommel;

/**
 * Vulnerability_Widget.
 *
 * @TODO...
 */
class Vulnerability_Admin_Widget {

	/**
	 * The Widget ID.
	 *
	 * @var string
	 */
	protected $id;

	/**
	 * The name/title of the widget.
	 *
	 * @var string
	 */
	protected $name;

	/**
	 * The service that handles logic about "WPScan Vulnerability Database".
	 *
	 * @var \Rommel\Vulnerability_Service
	 */
	protected $service;

	/**
	 * Constructor.
	 *
	 * @param string $text_domain
	 *   The text domain for the plugin.
	 * @param \Rommel\Vulnerability_Service $service
	 *   The service that handles logic about "WPScan Vulnerability Database".
	 */
	public function __construct( $text_domain, Vulnerability_Service $service ) {
		$this->id = 'r_vulnerabilities';
		$this->name =  __( 'Vulnerabilities', $text_domain );
		$this->service = $service;

		// Get all active plugins - since we're not interested in inactive
		// plugins because their files aren't included during the bootstrap.
		$this->active_plugin_files = ! empty( $active_plugin_files ) ? $active_plugin_files : wp_get_active_and_valid_plugins();
	}

	/**
	 * @TODO...
	 */
	public function init() {
		wp_add_dashboard_widget(
			$this->id,
			$this->name,
			[ $this, 'display' ]
		);
	}

	/**
	 * @TODO...
	 */
	public function display() {
		foreach ( $this->service->get_new_vulnerabilities() as $plugin ) {
			echo $plugin['name'] . ': ' . $plugin['status'];
			echo '<br>';
		}
	}

}
